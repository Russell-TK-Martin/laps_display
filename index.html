<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Total Warrington Laps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0082C0; --accent:#EC6608; }
    html,body { height:100%; margin:0; }
    body {
      background: var(--bg);
      color: var(--accent);
      font-family: Roboto, Arial, sans-serif;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 24px;
    }
    .logo { width: 300px; }
    .title { font-size: 3vw; text-align: center; }
    .laps { color:#fff; font-weight:700; font-size: 10vw; line-height: 0.9; }
    .updated { color:#fff; font-size: 1.2vw; }
    @media (max-width: 1200px) {
      .title { font-size: 28px; }
      .laps { font-size: 100px; }
      .updated { font-size: 16px; }
    }
  </style>
</head>
<body>
  <img class="logo" src="https://documents.sms-timing.com/Files/Automatic-emailings/teamsportcrawley/teamsport_ekarting_logo.png" alt="TeamSport eKarting Logo" />
  <div class="title">Total Warrington Laps to date</div>
  <div id="laps" class="laps">—</div>
  <div id="updated" class="updated">Fetching…</div>

  <script>
    const FEED = "https://teamsport.app.n8n.cloud/webhook/laps.json";
    let currentValue = 0; // keep track of the last displayed number

    function animateNumber(from, to, duration, element) {
      const start = performance.now();
      function update(timestamp) {
        const progress = Math.min((timestamp - start) / duration, 1);
        const value = Math.floor(from + (to - from) * progress);
        element.textContent = new Intl.NumberFormat("en-GB").format(value);
        if (progress < 1) requestAnimationFrame(update);
      }
      requestAnimationFrame(update);
    }

    async function load() {
      try {
        const res = await fetch(FEED, { cache: "no-store" });
        const data = await res.json();
        const lapsEl = document.getElementById("laps");
        const updEl = document.getElementById("updated");

        if (data?.laps != null) {
          const newValue = Number(data.laps);

          // Animate from currentValue → newValue over 1 second
          animateNumber(currentValue, newValue, 1000, lapsEl);
          currentValue = newValue;

          updEl.textContent = `Last updated: ${data.lastUpdated ?? "—"}`;
        } else {
          lapsEl.textContent = "—";
          updEl.textContent = "No data yet…";
        }
      } catch (e) {
        document.getElementById("updated").textContent = "Error fetching data. Retrying…";
      }
    }

    // Load now, then refresh every 5 minutes
    load();
    setInterval(load, 300000);
  </script>
</body>
</html>
